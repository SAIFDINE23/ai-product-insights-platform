# .env.k8s - Variables d'environnement pour Kubernetes
# À utiliser pour configurer les déploiements

# ============================================
# CLUSTER CONFIGURATION
# ============================================
CLUSTER_NAME=ai-product-insights
CLUSTER_PROVIDER=kind  # kind, minikube, eks, gke, aks, etc.
NAMESPACE=ai-product-insights
KUBERNETES_VERSION=1.20+

# ============================================
# REGISTRY CONFIGURATION
# ============================================
DOCKER_REGISTRY=saifdine23
DOCKER_REGISTRY_TYPE=public  # public, private
IMAGE_PULL_POLICY=IfNotPresent  # Always, Never, IfNotPresent

# Services images
SCRAPER_SERVICE_IMAGE=saifdine23/scraper-service:latest
AI_ANALYSIS_SERVICE_IMAGE=saifdine23/ai-analysis-service:latest
STATS_SERVICE_IMAGE=saifdine23/stats-service:latest
DASHBOARD_FRONTEND_IMAGE=saifdine23/dashboard-frontend:latest

# ============================================
# DATABASE CONFIGURATION
# ============================================
POSTGRES_VERSION=16-alpine
POSTGRES_USER=app_user
POSTGRES_PASSWORD=app_password  # À changer en production!
POSTGRES_DB=product_insights
POSTGRES_HOST=postgres-service
POSTGRES_PORT=5432
POSTGRES_PVC_SIZE=10Gi

# Database replica config (optionnel - pour StatefulSet)
POSTGRES_REPLICAS=1
POSTGRES_REPLICATION_ENABLED=false

# ============================================
# BACKEND SERVICES CONFIGURATION
# ============================================
# Scraper Service
SCRAPER_REPLICAS=1
SCRAPER_MEMORY_REQUEST=128Mi
SCRAPER_MEMORY_LIMIT=256Mi
SCRAPER_CPU_REQUEST=100m
SCRAPER_CPU_LIMIT=200m

# AI Analysis Service
AI_ANALYSIS_REPLICAS=1
AI_ANALYSIS_MEMORY_REQUEST=256Mi
AI_ANALYSIS_MEMORY_LIMIT=512Mi
AI_ANALYSIS_CPU_REQUEST=200m
AI_ANALYSIS_CPU_LIMIT=400m

# Stats Service
STATS_REPLICAS=1
STATS_MEMORY_REQUEST=128Mi
STATS_MEMORY_LIMIT=256Mi
STATS_CPU_REQUEST=100m
STATS_CPU_LIMIT=200m

# ============================================
# FRONTEND CONFIGURATION
# ============================================
FRONTEND_REPLICAS=2
FRONTEND_MEMORY_REQUEST=64Mi
FRONTEND_MEMORY_LIMIT=128Mi
FRONTEND_CPU_REQUEST=50m
FRONTEND_CPU_LIMIT=100m
VITE_API_BASE_URL=http://stats-service:8000

# ============================================
# AUTO-SCALING (HPA)
# ============================================
HPA_ENABLED=true
HPA_MIN_REPLICAS_BACKEND=1
HPA_MAX_REPLICAS_BACKEND=3
HPA_MIN_REPLICAS_FRONTEND=2
HPA_MAX_REPLICAS_FRONTEND=5
HPA_CPU_THRESHOLD=70  # %
HPA_MEMORY_THRESHOLD=80  # %

# ============================================
# INGRESS CONFIGURATION
# ============================================
INGRESS_ENABLED=true
INGRESS_CLASS=nginx
INGRESS_HOST=localhost  # Changer pour domaine en production
INGRESS_TLS_ENABLED=false  # À activer avec cert-manager
INGRESS_TLS_ISSUER=letsencrypt-prod  # Avec cert-manager

# Route configuration
INGRESS_ROOT_PATH=/
INGRESS_API_PATH=/api
INGRESS_STATS_PATH=/api/stats

# ============================================
# NETWORK POLICIES
# ============================================
NETWORK_POLICIES_ENABLED=true
DEFAULT_DENY_INGRESS=true
DEFAULT_DENY_EGRESS=true

# ============================================
# MONITORING & LOGGING
# ============================================
MONITORING_ENABLED=false
PROMETHEUS_ENABLED=false
GRAFANA_ENABLED=false
LOGGING_ENABLED=false
ELASTICSEARCH_ENABLED=false
KIBANA_ENABLED=false

LOG_LEVEL=INFO

# ============================================
# SECURITY
# ============================================
POD_SECURITY_POLICY_ENABLED=true
RBAC_ENABLED=true
RUN_AS_NON_ROOT=true
READ_ONLY_ROOT_FILESYSTEM=true
ALLOW_PRIVILEGE_ESCALATION=false

# ============================================
# RESOURCE QUOTAS
# ============================================
ENABLE_RESOURCE_QUOTAS=false
NAMESPACE_CPU_LIMIT=2000m
NAMESPACE_MEMORY_LIMIT=2Gi

# ============================================
# HEALTH CHECKS
# ============================================
LIVENESS_INITIAL_DELAY=30
LIVENESS_PERIOD=10
LIVENESS_TIMEOUT=5
LIVENESS_FAILURE_THRESHOLD=3

READINESS_INITIAL_DELAY=10
READINESS_PERIOD=5
READINESS_TIMEOUT=5
READINESS_FAILURE_THRESHOLD=2

# ============================================
# STORAGE
# ============================================
STORAGE_CLASS=standard  # Adapter à votre cluster
POSTGRES_BACKUP_ENABLED=false
BACKUP_RETENTION_DAYS=7

# ============================================
# NODE AFFINITY
# ============================================
ENABLE_POD_ANTI_AFFINITY=true
ENABLE_NODE_AFFINITY=false

# Labels des nœuds pour l'affinité (optionnel)
# NODE_LABEL_KEY=node-type
# NODE_LABEL_VALUE=backend

# ============================================
# CI/CD INTEGRATION
# ============================================
CI_CD_ENABLED=true
ARGOCD_ENABLED=false  # GitOps avec ArgoCD
FLUX_ENABLED=false    # GitOps avec Flux
KUSTOMIZE_ENABLED=false

# ============================================
# TESTING
# ============================================
SMOKE_TESTS_ENABLED=true
INTEGRATION_TESTS_ENABLED=false

# ============================================
# ENVIRONMENT
# ============================================
ENVIRONMENT=development  # development, staging, production
ENVIRONMENT_NAME=dev
REGION=local  # local, aws, gcp, azure

# ============================================
# NOTIFICATIONS
# ============================================
SLACK_NOTIFICATIONS_ENABLED=false
SLACK_WEBHOOK_URL=
EMAIL_NOTIFICATIONS_ENABLED=false

# ============================================
# COST OPTIMIZATION
# ============================================
ENABLE_SPOT_INSTANCES=false  # AWS Spot, GCP Preemptible
PREEMPTIBLE_REPLICAS=0

# ============================================
# DEBUG
# ============================================
DEBUG=false
VERBOSE_LOGGING=false
KEEP_FAILED_PODS=false  # Ne pas supprimer les pods crashés

# ============================================
# TIMEOUTS
# ============================================
KUBECTL_TIMEOUT=300s
DEPLOYMENT_TIMEOUT=300s
SERVICE_STARTUP_TIMEOUT=120s

# ============================================
# NOTES
# ============================================
# 1. Pour utiliser ces variables dans les manifests:
#    - Passer par un tool comme kustomize ou helm
#    - Ou utiliser des scripts de templating (envsubst, etc.)
#
# 2. JAMAIS committer les secrets en clair sur git!
#    - Utiliser Sealed Secrets, Vault, ou AWS Secrets Manager
#
# 3. Pour production:
#    - Activer TLS/HTTPS
#    - Changer les credentials par défaut
#    - Activer les network policies
#    - Mettre en place le monitoring
#    - Configurer les backups
#
# 4. Utilisation:
#    source .env.k8s
#    export $(cut -d= -f1 .env.k8s | grep -v '^#')
#    kubectl set env deployment/stats-service \
#      LOG_LEVEL=$LOG_LEVEL -n $NAMESPACE
